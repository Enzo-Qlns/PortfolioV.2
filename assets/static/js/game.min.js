const cont=document.getElementById("game"),maze=document.getElementById("maze"),thingie=document.getElementById("thingie"),home=document.getElementById("home"),emo=document.getElementById("emo"),textWin=document.getElementById("textWin"),bu=document.getElementById("bu"),bd=document.getElementById("bd"),bl=document.getElementById("bl"),br=document.getElementById("br"),step=20,size=20,bwidth=2,mazeHeight=200,mazeWidth=300;let nogoX=[],nogoX2=[],nogoY=[],nogoY2=[],prevDist=600,lastUD=0,lastLR=0;const mThreshold=15;let firstMove=!0,allowTilt=!0;const sThreshold=15,scThreshold=20;genSides();let my=10,mx=15,grid=[];for(let i=0;i<my;i++){let e=[];for(let t=0;t<mx;t++)e.push({u:0,d:0,l:0,r:0,v:0});grid.push(e)}let dirs=["u","d","l","r"],modDir={u:{y:-1,x:0,o:"d"},d:{y:1,x:0,o:"u"},l:{y:0,x:-1,o:"r"},r:{y:0,x:1,o:"l"}};genMaze(0,0,0),drawMaze();const barriers=document.getElementsByClassName("barrier");for(let b=0;b<barriers.length;b++)nogoX.push(barriers[b].offsetLeft),nogoX2.push(barriers[b].offsetLeft+barriers[b].clientWidth),nogoY.push(barriers[b].offsetTop),nogoY2.push(barriers[b].offsetTop+barriers[b].clientHeight);function keys(e){let t=e.code;switch(t){case"ArrowUp":case"KeyW":up();break;case"ArrowDown":case"KeyS":down();break;case"ArrowLeft":case"KeyA":left();break;case"ArrowRight":case"KeyD":right()}}function up(){animKeys(bu),checkYboundry("u")&&(thingie.style.top=thingie.offsetTop-20+"px",updateEmo(!1))}function down(){animKeys(bd),checkYboundry("d")&&(thingie.style.top=thingie.offsetTop+20+"px",updateEmo(!1))}function left(){animKeys(bl),checkXboundry("l")&&(thingie.style.left=thingie.offsetLeft-20+"px"),updateEmo(!0)}function right(){animKeys(br),checkXboundry("r")&&(thingie.style.left=thingie.offsetLeft+20+"px"),updateEmo(!0)}function checkXboundry(e){let t=thingie.offsetLeft,o=thingie.offsetTop,l=[],s=Math.max(nogoX.length,nogoX2.length,nogoY.length,nogoY2.length),n=0;for(let a=0;a<s;a++)n=0,(o<nogoY[a]||o>nogoY2[a]-20)&&(n=1),"r"===e&&(t<nogoX[a]-20||t>nogoX2[a]-20)&&(n=1),"l"===e&&(t<nogoX[a]||t>nogoX2[a])&&(n=1),l.push(n);return l.every(function(e){return e>0})}function checkYboundry(e){let t=thingie.offsetLeft,o=thingie.offsetTop,l=[],s=Math.max(nogoX.length,nogoX2.length,nogoY.length,nogoY2.length),n=0;for(let a=0;a<s;a++)n=0,(t<nogoX[a]||t>nogoX2[a]-20)&&(n=1),"u"===e&&(o<nogoY[a]||o>nogoY2[a])&&(n=1),"d"===e&&(o<nogoY[a]-20||o>nogoY2[a]-20)&&(n=1),l.push(n);return l.every(function(e){return e>0})}function genSides(){let e=20*Math.floor(10*Math.random()),t=180-e,o=document.createElement("div");o.style.top="20px",o.style.left="20px",o.style.height=e+"px";let l=document.createElement("div");l.style.top=e+40+"px",l.style.left="20px",l.style.height=t+"px";let s=document.createElement("div");s.style.top="20px",s.style.left="320px",s.style.height=t+"px";let n=document.createElement("div");n.style.top=t+40+"px",n.style.left="320px",n.style.height=e+"px",nogoX.push(0,340,0,0,320,320),nogoX2.push(2,342,20,20,340,340),nogoY.push(e+20,t+20,e+20,e+40,t+20,t+40),nogoY2.push(e+40,t+40,e+20+2,e+40+2,t+20+2,t+40+2),thingie.style.top=e+20+"px",thingie.style.left="0px",home.style.top=t+20+"px",home.style.left="320px";let a=[o,l,s,n];for(let r=0;r<a.length;r++)confSideEl(a[r]),maze.appendChild(a[r])}function confSideEl(e){e.setAttribute("class","barrier"),e.style.width="2px"}function genMaze(e,t,o){let l=limShuffle(dirs,o);for(let s=0;s<l.length;s++){let n=e+modDir[l[s]].x,a=t+modDir[l[s]].y;grid[t][e].v=1,n>=0&&n<mx&&a>=0&&a<my&&0===grid[a][n].v&&(grid[t][e][l[s]]=1,grid[a][n][modDir[l[s]].o]=1,genMaze(n,a,s))}}function drawMaze(){for(let e=0;e<mx;e++)for(let t=0;t<my;t++){let o=grid[t][e].l,l=grid[t][e].r,s=grid[t][e].u,n=grid[t][e].d;drawLines(e,t,o,l,s,n)}}function drawLines(e,t,o,l,s,n){let a=(t+1)*20,r=(e+1)*20;if(0===o&&e>0){let f=document.createElement("div");f.style.left=r+"px",f.style.height="20px",f.style.top=a+"px",f.setAttribute("class","barrier"),f.style.width="2px",maze.appendChild(f)}if(0===n&&t<my-1){let $=document.createElement("div");$.style.left=r+"px",$.style.height="2px",$.style.top=a+20+"px",$.setAttribute("class","barrier"),$.style.width="22px",maze.appendChild($)}}function limShuffle(e,t){let o=e.slice(0,t),l=e.slice(t,e.length);for(let s=l.length-1;s>0;s--){let n=Math.floor(Math.random()*(s+1));[l[s],l[n]]=[l[n],l[s]]}return o.concat(l)}function animKeys(e){"bu"===e.id&&(e.style.border="3px #fff solid",e.style.borderTop="1px #fff solid",e.style.borderBottom="4px #fff solid",e.style.transform="translateY(-2px)"),"bd"===e.id&&(e.style.border="3px #fff solid",e.style.borderBottom="1px #fff solid",e.style.borderTop="4px #fff solid",e.style.transform="translateY(2px)"),"bl"===e.id&&(e.style.border="3px #fff solid",e.style.borderLeft="1px #fff solid",e.style.borderRight="4px #fff solid",e.style.transform="translateX(-2px)"),"br"===e.id&&(e.style.border="3px #fff solid",e.style.borderRight="1px #fff solid",e.style.borderLeft="4px #fff solid",e.style.transform="translateX(2px)"),setTimeout(()=>{e.style.border="2px #fff solid",e.style.borderTop="2px #fff solid",e.style.borderBottom="2px #fff solid",e.style.borderLeft="2px #fff solid",e.style.borderRight="2px #fff solid",e.style.transform="translateY(0px)",e.style.transform="translateX(0px)"},"150")}document.addEventListener("keydown",keys),bu.addEventListener("click",e=>{up(),firstMove=!0}),bd.addEventListener("click",e=>{down(),firstMove=!0}),bl.addEventListener("click",e=>{left(),firstMove=!0}),br.addEventListener("click",e=>{right(),firstMove=!0});let maxl=0,prevl=0;function updateEmo(e){e?(thingie.offsetLeft<maxl&&(emo.innerHTML="\uD83D\uDE44"),thingie.offsetLeft<maxl-40&&(emo.innerHTML="\uD83D\uDE12"),thingie.offsetLeft<maxl-80&&(emo.innerHTML="\uD83D\uDE23"),thingie.offsetLeft<maxl-120&&(emo.innerHTML="\uD83E\uDD2C"),thingie.offsetLeft>prevl&&(emo.innerHTML="\uD83D\uDE10"),thingie.offsetLeft>=maxl&&(thingie.offsetLeft>180?emo.innerHTML="\uD83D\uDE00":emo.innerHTML="\uD83D\uDE42",maxl=thingie.offsetLeft),0===thingie.offsetLeft&&(emo.innerHTML="\uD83D\uDE22"),thingie.offsetLeft>280&&thingie.offsetTop===home.offsetTop&&(emo.innerHTML="\uD83E\uDD17",home.innerHTML="\uD83C\uDFE0"),thingie.offsetLeft>300&&(emo.innerHTML="",home.innerHTML="\uD83E\uDD73",textWin.innerHTML="Bravo!!"),prevl=thingie.offsetLeft):thingie.offsetLeft>280&&thingie.offsetTop===home.offsetTop?emo.innerHTML="\uD83E\uDD17":thingie.offsetLeft>280&&thingie.offsetTop!=home.offsetTo&&(emo.innerHTML="\uD83D\uDE44")}function tiltTimer(){allowTilt=!1,setTimeout(()=>{allowTilt=!0},"200")}function handleOrientation(e){firstMove&&(lastUD=e.beta,lastLR=e.gamma,firstMove=!1),allowTilt&&(e.beta<lastUD-15&&(up(),tiltTimer()),e.beta>lastUD+15&&(down(),tiltTimer()),e.gamma<lastLR-15&&(left(),tiltTimer()),e.gamma>lastLR+15&&(right(),tiltTimer()))}window.addEventListener("deviceorientation",handleOrientation);let haveEvents="ongamepadconnected"in window,gp=[],allowU=!0,allowD=!0,allowL=!0,allowR=!0,allowAU=!0,allowAD=!0,allowAL=!0,allowAR=!0;function disconnectGamepad(){gp=[]}function connectGamepad(e){console.log("trying to connect"),gp[0]=e.gamepad,requestAnimationFrame(updateStatus)}function updateStatus(){haveEvents||scangamepads();for(let e=0;e<gp[0].buttons.length;e++)gp[0].buttons[12].pressed&&allowU&&(up(),gpTimer("u")),!1===gp[0].buttons[12].pressed&&(allowU=!0),gp[0].buttons[13].pressed&&allowD&&(down(),gpTimer("d")),!1===gp[0].buttons[13].pressed&&(allowD=!0),gp[0].buttons[14].pressed&&allowL&&(left(),gpTimer("l")),!1===gp[0].buttons[14].pressed&&(allowL=!0),gp[0].buttons[15].pressed&&allowR&&(right(),gpTimer("r")),!1===gp[0].buttons[15].pressed&&(allowR=!0);for(let t=0;t<gp[0].axes.length;t++)(gp[0].axes[1]<-.8||gp[0].axes[3]<-.8)&&allowAU&&(up(),gpATimer("u")),(gp[0].axes[1]>.8||gp[0].axes[3]>.8)&&allowAD&&(down(),gpATimer("d")),(gp[0].axes[0]<-.8||gp[0].axes[2]<-.8)&&allowAL&&(left(),gpATimer("l")),(gp[0].axes[0]>.8||gp[0].axes[2]>.8)&&allowAR&&(right(),gpATimer("r"));requestAnimationFrame(updateStatus)}function scangamepads(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++)e[t]&&(e[t].index in gp?gp[e[t].index]=e[t]:addgamepad(e[t]))}function gpTimer(e){switch(e){case"u":allowU=!1;break;case"d":allowD=!1;break;case"l":allowL=!1;break;case"r":allowR=!1}setTimeout(()=>{allowU=!0,allowD=!0,allowL=!0,allowR=!0},"200")}function gpATimer(e){switch(e){case"u":allowAU=!1;break;case"d":allowAD=!1;break;case"l":allowAL=!1;break;case"r":allowAR=!1}setTimeout(()=>{allowAU=!0,allowAD=!0,allowAL=!0,allowAR=!0},"200")}window.addEventListener("gamepadconnected",connectGamepad),window.addEventListener("gamepaddisconnected",disconnectGamepad),haveEvents||setInterval(scangamepads,500);let lasttouchpY=0,lasttouchpX=0;cont.addEventListener("touchstart",e=>{lasttouchpY=e.changedTouches[0].pageY,lasttouchpX=e.changedTouches[0].pageX}),cont.addEventListener("touchmove",e=>{e.preventDefault();let t=e.changedTouches[0].pageY-lasttouchpY,o=e.changedTouches[0].pageX-lasttouchpX;t>15?(down(),lasttouchpY=e.changedTouches[0].pageY):t<-15&&(up(),lasttouchpY=e.changedTouches[0].pageY),o>15?(right(),lasttouchpX=e.changedTouches[0].pageX):o<-15&&(left(),lasttouchpX=e.changedTouches[0].pageX)});let lastscrollpY=0,lastscrollpX=0;cont.addEventListener("wheel",e=>{(lastscrollpY+=e.deltaY)>0&&e.deltaY<0&&(lastscrollpY=0),lastscrollpY<0&&e.deltaY>0&&(lastscrollpY=0),lastscrollpY>20&&(up(),lastscrollpY=0),lastscrollpY<-20&&(down(),lastscrollpY=0),(lastscrollpX+=e.deltaX)>0&&e.deltaX<0&&(lastscrollpX=0),lastscrollpX<0&&e.deltaX>0&&(lastscrollpX=0),lastscrollpX>20&&(left(),lastscrollpX=0),lastscrollpX<-20&&(right(),lastscrollpX=0)});
